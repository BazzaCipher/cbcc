---
import { type ContactUsSection } from 'types';

interface Props extends ContactUsSection {
  'data-sb-field-path'?: string;
}

const {
  title = 'Contact Us',
  subtitle = 'Weâ€™d love to hear from you. Please fill out the form below.',
} = Astro.props as Props;
const formAction = 'https://api.web3forms.com/submit';
const accessKey = 'f4d8f006-2233-4d8b-a682-38238c031487';
const siteOrigin = Astro.site ? new URL(Astro.site).origin : '';
const redirectUrl = `${siteOrigin}/thanks`;
---

<section
  class="bg-white py-16 px-6 md:px-12 lg:px-20"
  data-sb-field-path="contactusform"
>
	<div class="max-w-4xl mx-auto text-center">
		<h2 class="text-3xl md:text-4xl font-bold mb-4">{title}</h2>
		<p class="text-gray-600 mb-5">{subtitle}</p>
	</div>

	<form 
		action={formAction} 
		method="POST" 
		class="max-w-3xl mx-auto grid gap-6 mt-5"
		id="contact-form"
	>
    <!-- <input type="hidden" name="access_key" value={accessKey} /> -->

	<div id="form-message" class="text-center mt-4 hidden">
		<p id="form-message-text" class="text-green-600 font-medium"></p>
	</div>

    <div class="grid md:grid-cols-2 gap-6">
		<input 
			type="text" 
			name="name" 
			placeholder="Name" 
			required 
			class="w-full border border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-blue-500"}
		/>
		<input 
			type="text" 
			name="email" 
			placeholder="Email" 
			pattern="\w+@\w+\.\w+"
			required 
			class="w-full border border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-blue-500"}
		/>

		<input 
			type="tel" 
			name="phonenumber" 
			placeholder="Phone number" 
			pattern="\d+"
			class="w-full border border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-blue-500"}
		/>
		<input 
			type="text" 
			name="postcode" 
			placeholder="Postcode" 
			pattern="[0-9]{4}"
			class="w-full border border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-blue-500"}
		/>
    </div>

    <textarea 
      name="message" 
      rows="6" 
      placeholder="Your message" 
      required 
      class="w-full border border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-blue-500"}
    ></textarea>

    <div class="text-center">
      <button 
        type="submit" 
        class="bg-blue-600 text-white font-semibold px-8 py-3 rounded-lg hover:bg-blue-700 transition"}
      >
        Send Message
      </button>
    </div>

	<input type="checkbox" name="botcheck" class="hidden" style="display: none;">
	</form>
</section>

<script is:inline>
	const form = document.getElementById('contact-form');
	const msgBox = document.getElementById('form-message');
    const msgText = document.getElementById('form-message-text');

	form?.addEventListener('submit', async (e) => {
	e.preventDefault();
	const formData = new FormData(form);

	try {
		const response = await fetch(form.action, {
			method: 'POST',
			headers: { Accept: 'application/json' },
			body: formData
		});

		
	if (response.ok) {
		form.reset();
		msgText.textContent = 'Thank you! Your message has been sent.';
		msgText.className = 'text-green-600 font-medium';
		msgBox.classList.remove('hidden');
	} else {
		const json = await response.json();
		msgText.textContent = json.message || 'Something went wrong.';
		msgText.className = 'text-red-600 font-medium';
		msgBox.classList.remove('hidden');
	}
    } catch (err) {
		msgText.textContent = 'There was a network error.';
		msgText.className = 'text-red-600 font-medium';
		msgBox.classList.remove('hidden');
	}
	});
</script>
